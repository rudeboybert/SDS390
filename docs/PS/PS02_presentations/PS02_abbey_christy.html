<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>SDS390 - Problem Set 02</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../390.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">SDS390</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://otexts.com/fpp3/" rel="" target="">
 <span class="menu-text">FPP</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://app.datacamp.com/learn/assignments" rel="" target="">
 <span class="menu-text">DC</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://chat.openai.com/" rel="" target="">
 <span class="menu-text">ChatGPT</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../PS.html" rel="" target="">
 <span class="menu-text">Problem Sets</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://docs.google.com/spreadsheets/d/12GJWpG53UQgVwG-TEms5uT88HKSkh-m3g81k63SV_YA/edit#gid=0" rel="" target="">
 <span class="menu-text">Roster</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://drive.google.com/drive/u/1/folders/1ctkp8FthWTOSvCZfEZAl63XtCZA5c8KV" rel="" target="">
 <span class="menu-text">Screencasts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://moodle.smith.edu/course/view.php?id=47365" rel="" target="">
 <span class="menu-text">Moodle</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://docs.google.com/document/d/1pYACVZ91x21ffbMDfCgFGqvjM0v9YFiTSGX2-TwHUNE/edit#heading=h.amnifumas6q" rel="" target="">
 <span class="menu-text">Syllabus</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#load-and-explore-data" id="toc-load-and-explore-data" class="nav-link active" data-scroll-target="#load-and-explore-data">1. Load and explore data</a></li>
  <li><a href="#decomposition-plots" id="toc-decomposition-plots" class="nav-link" data-scroll-target="#decomposition-plots">2. Decomposition Plots</a></li>
  <li><a href="#forecasting-using-an-ar2-model" id="toc-forecasting-using-an-ar2-model" class="nav-link" data-scroll-target="#forecasting-using-an-ar2-model">3. Forecasting using an AR(2) model</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Problem Set 02</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><a href="https://colab.research.google.com/github/rudeboybert/SDS390/blob/master/PS/PS02.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a></p>
<p>Instructions: 1. Name: Christy Yang 1. Create a new ChatGPT chat called “SDS390 PS02” that contains all the prompts you used for this problem set, click the share button, and paste the URL in Markdown format <a href="https://www.smith.edu/">here</a></p>
<div class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="load-and-explore-data" class="level1">
<h1>1. Load and explore data</h1>
<ol type="1">
<li>Load the CSV data of biweekly dendroband measures for tree with tag 82203</li>
<li>Look at the raw data (rows and variables) and meta-data as Amir always told me to do</li>
<li>Note that DBH is the only non-index variable we will work with, thus simplify the data frame to only have this variable</li>
<li>Plot the time series of DBH (diameter at breast height, in mm) as we’ve done numerous times in DataCamp: just using <code>.plot()</code> with no arguments</li>
<li>Now plot the time series where each of the 147 observed data point is marked with a dot. In other words, your plot should at the very least have these <a href="https://github.com/rudeboybert/SDS390/blob/master/PS/tag_82203_plot.pdf">points</a>.</li>
<li>What is the difference in information presented between the two plots?</li>
<li>Describe any patterns you observe in the time series where each observed data point is marked with a dot</li>
</ol>
<p>6.The ‘Time Series of DBH with Observed Points’ is a scatter plot that displays the actual data points of the DBH measurements. Each individual data point corresponds directly to an exact value recorded in the data table. This plot provides the precise discrete observations.</p>
<p>In contrast, the ‘Time Series of DBH’ connects these data points with a continuous line, creating a line graph that illustrates the trends and variations in DBH over time. This line line graph offers a smoother and continuous view of how DBH values, better for the observation of trends and patterns in the data.</p>
<p>7.The plot as a whole reveals a consistent and upward trend in DBH (Diameter at Breast Height) from 2010 to 2020, which aligns with the natural growth pattern of trees. Additionally, the plot illustrates the influence of seasonal variation on DBH. DBH experiences a rapid increase during the second and third quarters of each year. However, it is important to note that there are data gaps in the first and fourth quarters of each year, resulting in blank areas on the plot during those periods. These gaps may be due to lack of measurement practices.</p>
<div class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">"tag_82203.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data.index)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the data</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Raw data:"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data.head())</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Data info:"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data.info())</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Get metadata</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>metadata <span class="op">=</span> data.describe()</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Metadata data:"</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(metadata)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Set date column as index</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'date'</span>] <span class="op">=</span> pd.to_datetime(data[<span class="st">'date'</span>])</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>data.set_index(<span class="st">'date'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>dbh <span class="op">=</span> data[<span class="st">'dbh'</span>]</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"dbh index"</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dbh.index)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Haven't explicitly set an index for the original DataFrame data, the index is a default integer-based index starting from 0 and incrementing by 1 for each row.</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>dbh.plot()</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Time'</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'diameter at breast height(mm)'</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Time Series of DBH'</span>)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>plt.plot(dbh, <span class="st">'o'</span>, markersize<span class="op">=</span><span class="dv">3</span>,label<span class="op">=</span><span class="st">'Observed Data Points'</span>)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Time Series of DBH with Observed Point"</span>)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Time"</span>)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"diameter at breast height(mm)"</span>)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RangeIndex(start=0, stop=147, step=1)
Raw data:
     tag  stemtag  survey.ID  year  month  day  intraannual    sp  measure  \
0  82203        1    2010.01  2010      1   27            1  litu    26.20   
1  82203        1    2011.01  2011      1   15            1  litu    41.10   
2  82203        1    2011.02  2011      5    9            1  litu    40.62   
3  82203        1    2011.03  2011      5   13            1  litu    40.21   
4  82203        1    2011.04  2011      5   16            1  litu    42.55   

  codes  ... status stemID  dendDiam  dbh_orig  new.band  dendroID  \
0   NaN  ...  alive  10045     610.0     611.3         1       106   
1   NaN  ...  alive  10045       NaN     611.3         0       106   
2   NaN  ...  alive  10045       NaN     611.3         0       106   
3   NaN  ...  alive  10045       NaN     611.3         0       106   
4   NaN  ...  alive  10045       NaN     611.3         0       106   

         date         dbh  scenario   data_source  
0  2010-01-27  611.300000         0  biweekly_dbh  
1  2011-01-15  616.049980         1  biweekly_dbh  
2  2011-05-09  615.896874         1  biweekly_dbh  
3  2011-05-13  615.766085         1  biweekly_dbh  
4  2011-05-16  616.512610         1  biweekly_dbh  

[5 rows x 21 columns]
Data info:
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 147 entries, 0 to 146
Data columns (total 21 columns):
 #   Column       Non-Null Count  Dtype  
---  ------       --------------  -----  
 0   tag          147 non-null    int64  
 1   stemtag      147 non-null    int64  
 2   survey.ID    147 non-null    float64
 3   year         147 non-null    int64  
 4   month        147 non-null    int64  
 5   day          147 non-null    int64  
 6   intraannual  147 non-null    int64  
 7   sp           147 non-null    object 
 8   measure      147 non-null    float64
 9   codes        1 non-null      object 
 10  notes        4 non-null      object 
 11  status       147 non-null    object 
 12  stemID       147 non-null    int64  
 13  dendDiam     6 non-null      float64
 14  dbh_orig     147 non-null    float64
 15  new.band     147 non-null    int64  
 16  dendroID     147 non-null    int64  
 17  date         147 non-null    object 
 18  dbh          147 non-null    float64
 19  scenario     147 non-null    int64  
 20  data_source  147 non-null    object 
dtypes: float64(5), int64(10), object(6)
memory usage: 24.2+ KB
None
Metadata data:
           tag  stemtag    survey.ID         year       month         day  \
count    147.0    147.0   147.000000   147.000000  147.000000  147.000000   
mean   82203.0      1.0  2014.919531  2014.836735    6.823129   15.598639   
std        0.0      0.0     2.876154     2.890800    2.331149    8.695503   
min    82203.0      1.0  2010.010000  2010.000000    1.000000    1.000000   
25%    82203.0      1.0  2012.135000  2012.000000    5.000000    9.000000   
50%    82203.0      1.0  2015.020000  2015.000000    7.000000   15.000000   
75%    82203.0      1.0  2017.115000  2017.000000    9.000000   23.000000   
max    82203.0      1.0  2020.060000  2020.000000   12.000000   31.000000   

       intraannual     measure   stemID    dendDiam    dbh_orig    new.band  \
count        147.0  147.000000    147.0    6.000000  147.000000  147.000000   
mean           1.0   80.126599  10045.0  629.500000  625.032650    0.013605   
std            0.0   37.011726      0.0   15.565989   14.113042    0.116242   
min            1.0   14.330000  10045.0  610.000000  611.300000    0.000000   
25%            1.0   55.510000  10045.0  616.750000  611.300000    0.000000   
50%            1.0   79.610000  10045.0  631.500000  627.799988    0.000000   
75%            1.0  110.085000  10045.0  641.000000  627.800000    0.000000   
max            1.0  147.000000  10045.0  648.000000  654.000000    1.000000   

         dendroID         dbh     scenario  
count  147.000000  147.000000   147.000000  
mean   224.285714  634.753251    14.707483  
std    290.730210   12.742316   166.028518  
min    106.000000  611.300000     0.000000  
25%    106.000000  624.144951     1.000000  
50%    106.000000  631.291928     1.000000  
75%    106.000000  644.381672     1.000000  
max    934.000000  658.634184  2014.000000  
dbh index
DatetimeIndex(['2010-01-27', '2011-01-15', '2011-05-09', '2011-05-13',
               '2011-05-16', '2011-05-24', '2011-06-06', '2011-06-13',
               '2011-06-20', '2011-06-27',
               ...
               '2019-09-05', '2019-10-02', '2019-10-17', '2019-11-06',
               '2020-03-11', '2020-03-30', '2020-04-14', '2020-05-02',
               '2020-05-15', '2020-05-31'],
              dtype='datetime64[ns]', name='date', length=147, freq=None)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="PS02_abbey_christy_files/figure-html/cell-3-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="PS02_abbey_christy_files/figure-html/cell-3-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select data from the year range 2014-2016</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>data_2014_2016 <span class="op">=</span> data[<span class="st">'2014-01-01'</span>:<span class="st">'2016-12-31'</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a scatter plot for the 'dbh' column within the selected date range</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>plt.scatter(data_2014_2016.index, data_2014_2016[<span class="st">'dbh'</span>], marker<span class="op">=</span><span class="st">'o'</span>, s<span class="op">=</span><span class="dv">30</span>, label<span class="op">=</span><span class="st">'Observed Data Points'</span>, color<span class="op">=</span><span class="st">'b'</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Scatter Plot of DBH (2014-2016)"</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Date"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"DBH (mm)"</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="PS02_abbey_christy_files/figure-html/cell-4-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="decomposition-plots" class="level1">
<h1>2. Decomposition Plots</h1>
<p>Create a seasonal decomposition plot of this data to answer the following questions: 1. What is the approximate growth (in mm) per year trend for this tree 1. What is the approximate range in seasonal variation in growth around this trend? 1. When are the peaks and when are the valleys in this seasonal variation? 1. Are there periods of time where we might be skeptical of the above trend and seasonality?</p>
<p>Note: You may need to do some data transformation as seen in the first DataCamp course to get a valid plot</p>
<ol type="1">
<li><p>Approximate Growth (in mm) per Year Trend:4.7 The approximate annual growth trend can be estimated by examining the ‘Trend Component’ plot.</p></li>
<li><p>Approximate Range in Seasonal Variation in Growth:[-1,1] The seasonal component represents the periodic fluctuations in growth. Values near 1 indicate the peak of the seasonal pattern, representing periods with higher-than-average values. Values near -1 indicate the trough of the seasonal pattern, representing periods with lower-than-average values. Values near 0 indicate average value.</p></li>
<li><p>Peaks:The third quarter of each year Valleys:The second quarter of each year</p></li>
<li><p>Periods of skeption may be related to irregularities in the data. The residual component represents the unexplained variations in the data after accounting for the trend and seasonality. The residual plot shows some remaining seasonality patterns, also called autocorrelation, it can be an indication of seasonality that hasn’t been completely removed by the decomposition process. This suggests that there may be external factors or seasonal patterns that are not completely captured by the seasonal decomposition. It seems that the two abnormal increases in early 2011 and the first half of 2019 in the residual plot correspond to the lack of measurement at that time.</p></li>
</ol>
<div class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.seasonal <span class="im">import</span> seasonal_decompose</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The seasonal_decompose does not handle missing values in the input time series data. </span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample the data to fill in missing monthes using forward fill to ensure having data for each month, allowing to better analyze these patterns.</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>data_resampled <span class="op">=</span> data[<span class="st">'dbh'</span>].resample(<span class="st">'M'</span>).mean().interpolate()</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Resample data:"</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data_resampled)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> seasonal_decompose(data_resampled, model<span class="op">=</span><span class="st">'additive'</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>trend <span class="op">=</span> result.trend</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>seasonal <span class="op">=</span> result.seasonal</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>residual <span class="op">=</span> result.resid</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(trend.describe())</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the components</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">411</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>plt.plot(data_resampled, label<span class="op">=</span><span class="st">'Original Data'</span>)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Original Data'</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">412</span>)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>plt.plot(trend, label<span class="op">=</span><span class="st">'Trend'</span>)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Trend Component'</span>)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">413</span>)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>plt.plot(seasonal, label<span class="op">=</span><span class="st">'Seasonal'</span>)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Seasonal Component'</span>)</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Format x-axis to show year and selected months (Jan, Apr, Jul, Oct)</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>months_to_show <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>]  <span class="co"># Months to display</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>plt.gca().xaxis.set_major_locator(MonthLocator(bymonth<span class="op">=</span>months_to_show, bymonthday<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>plt.gca().xaxis.set_major_formatter(DateFormatter(<span class="st">"%Y-%b"</span>))</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>) </span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">414</span>)</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>plt.plot(residual, label<span class="op">=</span><span class="st">'Residual'</span>)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Residual Component'</span>)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Resample data:
date
2010-01-31    611.300000
2010-02-28    611.695832
2010-03-31    612.091663
2010-04-30    612.487495
2010-05-31    612.883327
                 ...    
2020-01-31    657.888662
2020-02-29    657.904592
2020-03-31    657.920522
2020-04-30    658.548156
2020-05-31    658.533295
Freq: M, Name: dbh, Length: 125, dtype: float64
count    113.000000
mean     633.512231
std       11.701697
min      613.674990
25%      623.943440
50%      632.240265
75%      642.794528
max      657.540481
Name: trend, dtype: float64</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="PS02_abbey_christy_files/figure-html/cell-5-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="119">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>approximate_annual_growth <span class="op">=</span> (data_resampled.iloc[<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> data_resampled.iloc[<span class="dv">0</span>]) <span class="op">/</span>(data_resampled.index.year[<span class="op">-</span><span class="dv">1</span>]<span class="op">-</span>data_resampled.index.year[<span class="dv">0</span>])</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(approximate_annual_growth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4.723329467062672</code></pre>
</div>
</div>
</section>
<section id="forecasting-using-an-ar2-model" class="level1">
<h1>3. Forecasting using an AR(2) model</h1>
<p>In this exercise you will use an AR(2) model as seen in the second datacamp course “Time Series Analysis in Python” to forecast this tree’s size exactly two years into the future. Unfortunately since we aren’t covering ARIMA models until later in the course, we won’t be able to:</p>
<ol type="1">
<li>Ascertain the appropriateness of using an AR(2) model. Ex: are all assumptions met?</li>
<li>Fully interpret the model output’s meaning</li>
<li>Diagnose any issues.</li>
</ol>
<p>However, we will simply view this code as a minimally viable product that we will improve on later. Instructions: 1. Fit an appropriate AR(2) model 1. Print the summary of the result 1. Plot the TS data along with both in-sample fitted forecasts AND out-of-sample forecasts exactly two years into the future 1. Comment on the quality of the out-of-sample forecast. If you have any ideas on how to improve the forecast state them, if not no problem.</p>
<p>AR(2,0,0) Model parameters: const 634.536762 ar.L1 1.406552 ar.L2 -0.407624 sigma2 0.629942</p>
<p>AR(2,0,2) Model parameters: const 634.994306 ar.L1 1.575204 ar.L2 -0.576148 ma.L1 -0.195509 ma.L2 -0.018960 sigma2 0.626859</p>
<p>Adjust the model to let forcast value in increasing trend: The moving average order is 2, which represents 2 lag terms of the forecast errors to include in the model. It captures past forecast errors and their influence on the current value. But the positive AIC indicated a bad fitting.(disappear after a few running…)</p>
<p>The out-of-sample forecast doesn’t capture seasonality because the ARIMA(2,0,2) model used in this example is a simple autoregressive model that doesn’t explicitly show model seasonality.To improve the forecast quality, we can experiment with different ARIMA orders or models specifically designed to capture seasonality.</p>
<div class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.arima.model <span class="im">import</span> ARIMA</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_predict</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit an AR(2) model</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> ARIMA(data_resampled, order<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">2</span>))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>model_fitted <span class="op">=</span> model.fit()</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the summary of the result</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_fitted.summary())</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_fitted.params)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>fig, ax<span class="op">=</span>plt.subplots()</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>data_resampled.plot(ax<span class="op">=</span>ax)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>plot_predict(model_fitted,start<span class="op">=</span><span class="dv">0</span>, end<span class="op">=</span><span class="st">'2022'</span>,ax<span class="op">=</span>ax)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                               SARIMAX Results                                
==============================================================================
Dep. Variable:                    dbh   No. Observations:                  125
Model:                 ARIMA(2, 0, 2)   Log Likelihood                -151.598
Date:                Tue, 24 Oct 2023   AIC                            315.196
Time:                        10:41:24   BIC                            332.166
Sample:                    01-31-2010   HQIC                           322.090
                         - 05-31-2020                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const        634.9943     22.538     28.174      0.000     590.821     679.168
ar.L1          1.5752      0.397      3.967      0.000       0.797       2.353
ar.L2         -0.5761      0.398     -1.449      0.147      -1.355       0.203
ma.L1         -0.1955      0.403     -0.485      0.627      -0.985       0.594
ma.L2         -0.0190      0.174     -0.109      0.913      -0.360       0.322
sigma2         0.6269      0.030     20.869      0.000       0.568       0.686
===================================================================================
Ljung-Box (L1) (Q):                   0.66   Jarque-Bera (JB):              2322.77
Prob(Q):                              0.42   Prob(JB):                         0.00
Heteroskedasticity (H):               3.29   Skew:                             3.50
Prob(H) (two-sided):                  0.00   Kurtosis:                        22.92
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
const     634.994306
ar.L1       1.575204
ar.L2      -0.576148
ma.L1      -0.195509
ma.L2      -0.018960
sigma2      0.626859
dtype: float64</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="PS02_abbey_christy_files/figure-html/cell-7-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit an AR(2) model</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>model2 <span class="op">=</span> ARIMA(data_resampled, order<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>model2_fitted <span class="op">=</span> model2.fit()</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the summary of the result</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model2_fitted.summary())</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model2_fitted.params)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>fig, ax<span class="op">=</span>plt.subplots()</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>data_resampled.plot(ax<span class="op">=</span>ax)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>plot_predict(model2_fitted,start<span class="op">=</span><span class="dv">0</span>, end<span class="op">=</span><span class="st">'2022'</span>,ax<span class="op">=</span>ax)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                               SARIMAX Results                                
==============================================================================
Dep. Variable:                    dbh   No. Observations:                  125
Model:                 ARIMA(2, 0, 0)   Log Likelihood                -151.911
Date:                Tue, 24 Oct 2023   AIC                            311.822
Time:                        10:41:59   BIC                            323.135
Sample:                    01-31-2010   HQIC                           316.417
                         - 05-31-2020                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const        634.5368     22.073     28.747      0.000     591.274     677.800
ar.L1          1.4066      0.056     25.173      0.000       1.297       1.516
ar.L2         -0.4076      0.058     -7.003      0.000      -0.522      -0.294
sigma2         0.6299      0.030     21.244      0.000       0.572       0.688
===================================================================================
Ljung-Box (L1) (Q):                   1.65   Jarque-Bera (JB):              2335.09
Prob(Q):                              0.20   Prob(JB):                         0.00
Heteroskedasticity (H):               3.37   Skew:                             3.46
Prob(H) (two-sided):                  0.00   Kurtosis:                        23.01
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
const     634.536762
ar.L1       1.406552
ar.L2      -0.407624
sigma2      0.629942
dtype: float64</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="PS02_abbey_christy_files/figure-html/cell-8-output-2.png" class="img-fluid"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>